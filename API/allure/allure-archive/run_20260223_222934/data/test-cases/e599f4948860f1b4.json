{"uid":"e599f4948860f1b4","name":"Unauthorized roles cannot update service — guest_client_with_valid_api_key","fullName":"tests.test_model_management.test_model_management_update_services.TestModelManagementUpdateServices#test_update_service_unauthorized_roles","historyId":"5db0375a7b267b4ba6114c25dd457b8d","time":{"start":1771865991608,"stop":1771865994564,"duration":2956},"description":"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        ","descriptionHtml":"<pre><code>    USER &amp; GUEST: Attempt to update a service (should be denied)\n    Expected: 401 Unauthorized or 403 Forbidden\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x773754f29ea0>\nrole_client_fixture = 'guest_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_service_unauthorized_roles[guest_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.MINOR)\n    @allure.title(\"Unauthorized roles cannot update service — {role_client_fixture}\")\n    @pytest.mark.rbac\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"user_client_with_valid_api_key\",\n        \"guest_client_with_valid_api_key\"\n    ])\n    def test_update_service_unauthorized_roles(self, role_client_fixture, request):\n        \"\"\"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        \"\"\"\n        client = request.getfixturevalue(role_client_fixture)\n        role_name = role_client_fixture.replace(\"_client_with_valid_api_key\", \"\").upper()\n    \n        update_payload = ServiceWithPayloads.service_update_payload(\n            service_id=\"placeholder-service-id\",\n            service_description=\"This should not update\",\n            hardware_description=\"This should not update\",\n            is_published=False\n        )\n    \n        print(f\"\\n{'='*60}\")\n        print(f\"\uD83D\uDD0D Test: Update Service - {role_name} (Should be DENIED)\")\n        print(f\"\uD83D\uDD0D Endpoint: PATCH {settings.MODEL_MANAGEMENT_UPDATE_SERVICES}\")\n        print(f\"{'='*60}\")\n    \n        response = client.patch(settings.MODEL_MANAGEMENT_UPDATE_SERVICES, json=update_payload)\n    \n        print(f\"\uD83D\uDCCA Status Code: {response.status_code}\")\n        print(f\"\uD83D\uDCE6 Response: {response.text}\")\n    \n        # ASSERTION: Must be denied\n>       assert response.status_code in [401, 403], (\n            f\"[{role_name}] Expected 401/403, got {response.status_code}. \"\n            f\"This role should NOT have update service access!\"\n        )\nE       AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nE       assert 404 in [401, 403]\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_model_management/test_model_management_update_services.py:533: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1771865974284,"stop":1771865974284,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"guest_token_manager","time":{"start":1771865991609,"stop":1771865994412,"duration":2803},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"guest_client_with_valid_api_key","time":{"start":1771865994412,"stop":1771865994412,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        ","status":"failed","statusMessage":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x773754f29ea0>\nrole_client_fixture = 'guest_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_service_unauthorized_roles[guest_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.MINOR)\n    @allure.title(\"Unauthorized roles cannot update service — {role_client_fixture}\")\n    @pytest.mark.rbac\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"user_client_with_valid_api_key\",\n        \"guest_client_with_valid_api_key\"\n    ])\n    def test_update_service_unauthorized_roles(self, role_client_fixture, request):\n        \"\"\"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        \"\"\"\n        client = request.getfixturevalue(role_client_fixture)\n        role_name = role_client_fixture.replace(\"_client_with_valid_api_key\", \"\").upper()\n    \n        update_payload = ServiceWithPayloads.service_update_payload(\n            service_id=\"placeholder-service-id\",\n            service_description=\"This should not update\",\n            hardware_description=\"This should not update\",\n            is_published=False\n        )\n    \n        print(f\"\\n{'='*60}\")\n        print(f\"\uD83D\uDD0D Test: Update Service - {role_name} (Should be DENIED)\")\n        print(f\"\uD83D\uDD0D Endpoint: PATCH {settings.MODEL_MANAGEMENT_UPDATE_SERVICES}\")\n        print(f\"{'='*60}\")\n    \n        response = client.patch(settings.MODEL_MANAGEMENT_UPDATE_SERVICES, json=update_payload)\n    \n        print(f\"\uD83D\uDCCA Status Code: {response.status_code}\")\n        print(f\"\uD83D\uDCE6 Response: {response.text}\")\n    \n        # ASSERTION: Must be denied\n>       assert response.status_code in [401, 403], (\n            f\"[{role_name}] Expected 401/403, got {response.status_code}. \"\n            f\"This role should NOT have update service access!\"\n        )\nE       AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nE       assert 404 in [401, 403]\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_model_management/test_model_management_update_services.py:533: AssertionError","steps":[],"attachments":[{"uid":"1467f941601d9430","name":"Request — PATCH","source":"1467f941601d9430.json","type":"application/json","size":241},{"uid":"ac99c0144c3b0fe4","name":"Response — 404","source":"ac99c0144c3b0fe4.json","type":"application/json","size":144},{"uid":"cf328dfb7a1d0d","name":"stdout","source":"cf328dfb7a1d0d.txt","type":"text/plain","size":411},{"uid":"37fca27108c099fb","name":"stderr","source":"37fca27108c099fb.txt","type":"text/plain","size":319}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"guest_token_manager::0","time":{"start":1771865997518,"stop":1771865997518,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"severity","value":"minor"},{"name":"feature","value":"Model Management"},{"name":"story","value":"Update Services"},{"name":"tag","value":"rbac"},{"name":"parentSuite","value":"tests.test_model_management"},{"name":"suite","value":"test_model_management_update_services"},{"name":"subSuite","value":"TestModelManagementUpdateServices"},{"name":"host","value":"TI-LAP-1094"},{"name":"thread","value":"676750-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_model_management.test_model_management_update_services"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"role_client_fixture","value":"'guest_client_with_valid_api_key'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"minor","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":0,"unknown":0,"total":3},"items":[{"uid":"199284d060c7269a","status":"failed","statusDetails":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","time":{"start":1771865953690,"stop":1771865956671,"duration":2981}},{"uid":"864b79bc4221e0d","status":"failed","statusDetails":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","time":{"start":1771865764903,"stop":1771865767977,"duration":3074}}]},"tags":["rbac"]},"source":"e599f4948860f1b4.json","parameterValues":["'guest_client_with_valid_api_key'"]}