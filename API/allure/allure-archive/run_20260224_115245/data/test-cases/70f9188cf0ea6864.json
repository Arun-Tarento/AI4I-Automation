{"uid":"70f9188cf0ea6864","name":"Unauthorized roles cannot update service — guest_client_with_valid_api_key","fullName":"tests.test_model_management.test_model_management_update_services.TestModelManagementUpdateServices#test_update_service_unauthorized_roles","historyId":"5db0375a7b267b4ba6114c25dd457b8d","time":{"start":1771914160937,"stop":1771914161116,"duration":179},"description":"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        ","descriptionHtml":"<pre><code>    USER &amp; GUEST: Attempt to update a service (should be denied)\n    Expected: 401 Unauthorized or 403 Forbidden\n</code></pre>\n","status":"broken","statusMessage":"httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://dev.ai4inclusion.org/api/v1/auth/login'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x77b58b85a0e0>\nrole_client_fixture = 'guest_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_service_unauthorized_roles[guest_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.MINOR)\n    @allure.title(\"Unauthorized roles cannot update service — {role_client_fixture}\")\n    @pytest.mark.rbac\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"user_client_with_valid_api_key\",\n        \"guest_client_with_valid_api_key\"\n    ])\n    def test_update_service_unauthorized_roles(self, role_client_fixture, request):\n        \"\"\"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        \"\"\"\n>       client = request.getfixturevalue(role_client_fixture)\n\ntests/test_model_management/test_model_management_update_services.py:512: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:539: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:627: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1068: in execute\n    fixturedef = request._get_active_fixturedef(argname)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:627: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1110: in execute\n    result: FixtureValue = ihook.pytest_fixture_setup(\n../venv/lib/python3.10/site-packages/pluggy/_hooks.py:512: in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n../venv/lib/python3.10/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:53: in run_old_style_hookwrapper\n    return result.get_result()\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:38: in run_old_style_hookwrapper\n    res = yield\n../venv/lib/python3.10/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup\n    return (yield)\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:53: in run_old_style_hookwrapper\n    return result.get_result()\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:38: in run_old_style_hookwrapper\n    res = yield\n../venv/lib/python3.10/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup\n    return (yield)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1202: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:908: in call_fixture_func\n    fixture_result = next(generator)\nconftest.py:79: in guest_token_manager\n    token_manager = login_and_get_token_manager(settings.GUEST_USERNAME, settings.GUEST_PASSWORD)\nutils/auth.py:88: in login_and_get_token_manager\n    token_manager = TokenManager(email, password)\nutils/auth.py:21: in __init__\n    self._login()\nutils/auth.py:35: in _login\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Response [401 Unauthorized]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://dev.ai4inclusion.org/api/v1/auth/login'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401\n\n../venv/lib/python3.10/site-packages/httpx/_models.py:829: HTTPStatusError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1771914152283,"stop":1771914152283,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        ","status":"broken","statusMessage":"httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://dev.ai4inclusion.org/api/v1/auth/login'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x77b58b85a0e0>\nrole_client_fixture = 'guest_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_service_unauthorized_roles[guest_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.MINOR)\n    @allure.title(\"Unauthorized roles cannot update service — {role_client_fixture}\")\n    @pytest.mark.rbac\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"user_client_with_valid_api_key\",\n        \"guest_client_with_valid_api_key\"\n    ])\n    def test_update_service_unauthorized_roles(self, role_client_fixture, request):\n        \"\"\"\n        USER & GUEST: Attempt to update a service (should be denied)\n        Expected: 401 Unauthorized or 403 Forbidden\n        \"\"\"\n>       client = request.getfixturevalue(role_client_fixture)\n\ntests/test_model_management/test_model_management_update_services.py:512: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:539: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:627: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1068: in execute\n    fixturedef = request._get_active_fixturedef(argname)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:627: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1110: in execute\n    result: FixtureValue = ihook.pytest_fixture_setup(\n../venv/lib/python3.10/site-packages/pluggy/_hooks.py:512: in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n../venv/lib/python3.10/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:53: in run_old_style_hookwrapper\n    return result.get_result()\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:38: in run_old_style_hookwrapper\n    res = yield\n../venv/lib/python3.10/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup\n    return (yield)\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:53: in run_old_style_hookwrapper\n    return result.get_result()\n../venv/lib/python3.10/site-packages/pluggy/_callers.py:38: in run_old_style_hookwrapper\n    res = yield\n../venv/lib/python3.10/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup\n    return (yield)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:1202: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n../venv/lib/python3.10/site-packages/_pytest/fixtures.py:908: in call_fixture_func\n    fixture_result = next(generator)\nconftest.py:79: in guest_token_manager\n    token_manager = login_and_get_token_manager(settings.GUEST_USERNAME, settings.GUEST_PASSWORD)\nutils/auth.py:88: in login_and_get_token_manager\n    token_manager = TokenManager(email, password)\nutils/auth.py:21: in __init__\n    self._login()\nutils/auth.py:35: in _login\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Response [401 Unauthorized]>\n\n    def raise_for_status(self) -> Response:\n        \"\"\"\n        Raise the `HTTPStatusError` if one occurred.\n        \"\"\"\n        request = self._request\n        if request is None:\n            raise RuntimeError(\n                \"Cannot call `raise_for_status` as the request \"\n                \"instance has not been set on this response.\"\n            )\n    \n        if self.is_success:\n            return self\n    \n        if self.has_redirect_location:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"Redirect location: '{0.headers[location]}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n        else:\n            message = (\n                \"{error_type} '{0.status_code} {0.reason_phrase}' for url '{0.url}'\\n\"\n                \"For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/{0.status_code}\"\n            )\n    \n        status_class = self.status_code // 100\n        error_types = {\n            1: \"Informational response\",\n            3: \"Redirect response\",\n            4: \"Client error\",\n            5: \"Server error\",\n        }\n        error_type = error_types.get(status_class, \"Invalid status code\")\n        message = message.format(self, error_type=error_type)\n>       raise HTTPStatusError(message, request=request, response=self)\nE       httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://dev.ai4inclusion.org/api/v1/auth/login'\nE       For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401\n\n../venv/lib/python3.10/site-packages/httpx/_models.py:829: HTTPStatusError","steps":[],"attachments":[{"uid":"6a53f45343467083","name":"stderr","source":"6a53f45343467083.txt","type":"text/plain","size":211}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"feature","value":"Model Management"},{"name":"story","value":"Update Services"},{"name":"severity","value":"minor"},{"name":"tag","value":"rbac"},{"name":"parentSuite","value":"tests.test_model_management"},{"name":"suite","value":"test_model_management_update_services"},{"name":"subSuite","value":"TestModelManagementUpdateServices"},{"name":"host","value":"TI-LAP-1094"},{"name":"thread","value":"1149885-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_model_management.test_model_management_update_services"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"role_client_fixture","value":"'guest_client_with_valid_api_key'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"minor","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":1,"skipped":0,"passed":0,"unknown":0,"total":4},"items":[{"uid":"e599f4948860f1b4","status":"failed","statusDetails":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","time":{"start":1771865991608,"stop":1771865994564,"duration":2956}},{"uid":"199284d060c7269a","status":"failed","statusDetails":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","time":{"start":1771865953690,"stop":1771865956671,"duration":2981}},{"uid":"864b79bc4221e0d","status":"failed","statusDetails":"AssertionError: [GUEST] Expected 401/403, got 404. This role should NOT have update service access!\nassert 404 in [401, 403]\n +  where 404 = <Response [404 Not Found]>.status_code","time":{"start":1771865764903,"stop":1771865767977,"duration":3074}}]},"tags":["rbac"]},"source":"70f9188cf0ea6864.json","parameterValues":["'guest_client_with_valid_api_key'"]}