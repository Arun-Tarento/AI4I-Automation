{"uid":"93a7c147b5030967","name":"Publish and unpublish service — admin_client_with_valid_api_key","fullName":"tests.test_model_management.test_model_management_update_services.TestModelManagementUpdateServices#test_update_publish_unpublish_service","historyId":"fe72ee1e3d3504e6fdc9c3b1579331b4","time":{"start":1771914156696,"stop":1771914156866,"duration":170},"description":"\n        ADMIN & MODERATOR: Publish then unpublish a service\n        Flow: Create model → create service → publish → verify → unpublish → verify → cleanup\n        Expected: 200 with correct isPublished state after each update\n        ","descriptionHtml":"<pre><code>    ADMIN &amp; MODERATOR: Publish then unpublish a service\n    Flow: Create model → create service → publish → verify → unpublish → verify → cleanup\n    Expected: 200 with correct isPublished state after each update\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: [ADMIN] Model creation failed. Response: {\"detail\":{\"message\":\"API key not found\",\"code\":\"AUTHENTICATION_ERROR\",\"timestamp\":1771914156.8439484,\"details\":null}}\nassert 401 in [200, 201]\n +  where 401 = <Response [401 Unauthorized]>.status_code","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x77b58b8596c0>\nrole_client_fixture = 'admin_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_publish_unpublish_service[admin_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.title(\"Publish and unpublish service — {role_client_fixture}\")\n    @pytest.mark.business_case\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"admin_client_with_valid_api_key\",\n        \"moderator_client_with_valid_api_key\"\n    ])\n    def test_update_publish_unpublish_service(self, role_client_fixture, request):\n        \"\"\"\n        ADMIN & MODERATOR: Publish then unpublish a service\n        Flow: Create model → create service → publish → verify → unpublish → verify → cleanup\n        Expected: 200 with correct isPublished state after each update\n        \"\"\"\n        client = request.getfixturevalue(role_client_fixture)\n        role_name = role_client_fixture.replace(\"_client_with_valid_api_key\", \"\").upper()\n        timestamp = int(time.time())\n        model_uuid = None\n    \n        try:\n            # STEP 1: Create a model\n            model_name = ServiceWithPayloads.model_name(\n                role_name=role_name,\n                timestamp=timestamp\n            )\n            model_payload = ServiceWithPayloads.model_create_payload(\n                name=model_name,\n                version=\"1.0.0\",\n                task_type=\"asr\"\n            )\n            create_model_response = client.post(settings.MODEL_MANAGEMENT_CREATE, json=model_payload)\n>           assert create_model_response.status_code in [200, 201], (\n                f\"[{role_name}] Model creation failed. Response: {create_model_response.text}\"\n            )\nE           AssertionError: [ADMIN] Model creation failed. Response: {\"detail\":{\"message\":\"API key not found\",\"code\":\"AUTHENTICATION_ERROR\",\"timestamp\":1771914156.8439484,\"details\":null}}\nE           assert 401 in [200, 201]\nE            +  where 401 = <Response [401 Unauthorized]>.status_code\n\ntests/test_model_management/test_model_management_update_services.py:315: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1771914152283,"stop":1771914152283,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"admin_token_manager","time":{"start":1771914152284,"stop":1771914155987,"duration":3703},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"admin_client_with_valid_api_key","time":{"start":1771914155987,"stop":1771914155987,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n        ADMIN & MODERATOR: Publish then unpublish a service\n        Flow: Create model → create service → publish → verify → unpublish → verify → cleanup\n        Expected: 200 with correct isPublished state after each update\n        ","status":"failed","statusMessage":"AssertionError: [ADMIN] Model creation failed. Response: {\"detail\":{\"message\":\"API key not found\",\"code\":\"AUTHENTICATION_ERROR\",\"timestamp\":1771914156.8439484,\"details\":null}}\nassert 401 in [200, 201]\n +  where 401 = <Response [401 Unauthorized]>.status_code","statusTrace":"self = <test_model_management_update_services.TestModelManagementUpdateServices object at 0x77b58b8596c0>\nrole_client_fixture = 'admin_client_with_valid_api_key'\nrequest = <FixtureRequest for <Function test_update_publish_unpublish_service[admin_client_with_valid_api_key]>>\n\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.title(\"Publish and unpublish service — {role_client_fixture}\")\n    @pytest.mark.business_case\n    @pytest.mark.parametrize(\"role_client_fixture\", [\n        \"admin_client_with_valid_api_key\",\n        \"moderator_client_with_valid_api_key\"\n    ])\n    def test_update_publish_unpublish_service(self, role_client_fixture, request):\n        \"\"\"\n        ADMIN & MODERATOR: Publish then unpublish a service\n        Flow: Create model → create service → publish → verify → unpublish → verify → cleanup\n        Expected: 200 with correct isPublished state after each update\n        \"\"\"\n        client = request.getfixturevalue(role_client_fixture)\n        role_name = role_client_fixture.replace(\"_client_with_valid_api_key\", \"\").upper()\n        timestamp = int(time.time())\n        model_uuid = None\n    \n        try:\n            # STEP 1: Create a model\n            model_name = ServiceWithPayloads.model_name(\n                role_name=role_name,\n                timestamp=timestamp\n            )\n            model_payload = ServiceWithPayloads.model_create_payload(\n                name=model_name,\n                version=\"1.0.0\",\n                task_type=\"asr\"\n            )\n            create_model_response = client.post(settings.MODEL_MANAGEMENT_CREATE, json=model_payload)\n>           assert create_model_response.status_code in [200, 201], (\n                f\"[{role_name}] Model creation failed. Response: {create_model_response.text}\"\n            )\nE           AssertionError: [ADMIN] Model creation failed. Response: {\"detail\":{\"message\":\"API key not found\",\"code\":\"AUTHENTICATION_ERROR\",\"timestamp\":1771914156.8439484,\"details\":null}}\nE           assert 401 in [200, 201]\nE            +  where 401 = <Response [401 Unauthorized]>.status_code\n\ntests/test_model_management/test_model_management_update_services.py:315: AssertionError","steps":[],"attachments":[{"uid":"9e266bd8fbf8ad93","name":"Request — POST","source":"9e266bd8fbf8ad93.json","type":"application/json","size":1738},{"uid":"28913287cda2a3c0","name":"Response — 401","source":"28913287cda2a3c0.json","type":"application/json","size":163}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"admin_token_manager::0","time":{"start":1771914161818,"stop":1771914161818,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"feature","value":"Model Management"},{"name":"story","value":"Update Services"},{"name":"severity","value":"critical"},{"name":"tag","value":"business_case"},{"name":"parentSuite","value":"tests.test_model_management"},{"name":"suite","value":"test_model_management_update_services"},{"name":"subSuite","value":"TestModelManagementUpdateServices"},{"name":"host","value":"TI-LAP-1094"},{"name":"thread","value":"1149885-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_model_management.test_model_management_update_services"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"role_client_fixture","value":"'admin_client_with_valid_api_key'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":3,"unknown":0,"total":4},"items":[{"uid":"1d602579d1f98e70","status":"passed","time":{"start":1771865985217,"stop":1771865986653,"duration":1436}},{"uid":"d8b359f132e8acb9","status":"passed","time":{"start":1771865947022,"stop":1771865948702,"duration":1680}},{"uid":"c15afac6e0ac3232","status":"passed","time":{"start":1771865758522,"stop":1771865760014,"duration":1492}}]},"tags":["business_case"]},"source":"93a7c147b5030967.json","parameterValues":["'admin_client_with_valid_api_key'"]}